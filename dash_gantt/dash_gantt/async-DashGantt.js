"use strict";(self.webpackChunkdash_gantt=self.webpackChunkdash_gantt||[]).push([[192],{492:(t,e,a)=>{a.r(e),a.d(e,{default:()=>y});var n=a(609),o=a.n(n),r=a(120),i=a.n(r);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,o,r,i,l=[],s=!0,d=!1;try{if(r=(a=a.call(t)).next,0===e){if(Object(a)!==a)return;s=!1}else for(;!(s=(n=r.call(a)).done)&&(l.push(n.value),l.length!==e);s=!0);}catch(t){d=!0,o=t}finally{try{if(!s&&null!=a.return&&(i=a.return(),Object(i)!==i))return}finally{if(d)throw o}}return l}}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(Object(a),!0).forEach((function(e){c(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function c(t,e,a){return(e=f(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function h(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return m(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=Array(e);a<e;a++)n[a]=t[a];return n}function g(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var a=e.call(t,"string");if("object"!=l(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}function b(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(b=function(){return!!t})()}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function S(t,e){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},S(t,e)}var y=function(t){function e(t){var a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=function(t,e,a){return e=v(e),function(t,e){if(e&&("object"==l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,b()?Reflect.construct(e,a||[],v(t).constructor):e.apply(t,a))}(this,e,[t])).tableRef=o().createRef(),a.justFinishedDragging=!1,a.isCreatingSlot=!1;var n=t.rawData,r=t.date,i=e.transformData(n||[],r||(new Date).toISOString().split("T")[0]),s=i.professionals,d=i.timeslots;return a.state={selectedSlot:null,isAddingSlot:!1,newSlot:{professionalId:null,start:null,end:null},hoveredCell:null,slotWidthCache:{},professionals:s||[],timeslots:d||[],rawData:n||[],date:r||(new Date).toISOString().split("T")[0],isDragging:!1,dragSide:null,draggedSlot:null,originalSlot:null,dragPreview:null,dragType:null,creationStart:null,creationEnd:null,creationProfessionalId:null},a.handleSlotClick=a.handleSlotClick.bind(a),a.handleAddSlot=a.handleAddSlot.bind(a),a.handleCreateSlot=a.handleCreateSlot.bind(a),a.handleRemoveSlot=a.handleRemoveSlot.bind(a),a.handleSaveSlot=a.handleSaveSlot.bind(a),a.handleCancelEdit=a.handleCancelEdit.bind(a),a.handleCellHover=a.handleCellHover.bind(a),a.handleCellLeave=a.handleCellLeave.bind(a),a.renderSlotRectangle=a.renderSlotRectangle.bind(a),a.generateTimeCells=a.generateTimeCells.bind(a),a.formatTime=a.formatTime.bind(a),a.timeToDecimal=a.timeToDecimal.bind(a),a.calculateSlotWidth=a.calculateSlotWidth.bind(a),a.getSlotWidth=a.getSlotWidth.bind(a),a.updateRawData=a.updateRawData.bind(a),a.handleDragStart=a.handleDragStart.bind(a),a.handleDrag=a.handleDrag.bind(a),a.handleDragEnd=a.handleDragEnd.bind(a),a.handleCreationStart=a.handleCreationStart.bind(a),a.handleCreationDrag=a.handleCreationDrag.bind(a),a.handleCreationEnd=a.handleCreationEnd.bind(a),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e)}(e,t),a=e,n=[{key:"componentDidMount",value:function(){var t=this.props,a=t.rawData,n=t.date,o=e.transformData(a||[],n||this.state.date),r=o.professionals,i=o.timeslots;this.setState({professionals:r||[],timeslots:i||[],rawData:a||[],date:n||this.state.date})}},{key:"handleSlotClick",value:function(t){this.setState({selectedSlot:t,isAddingSlot:!1})}},{key:"handleCellHover",value:function(t,e,a){var n=this.state.hoveredCell;n&&n.professionalId===t&&n.hour===e&&n.minute===a||this.setState({hoveredCell:{professionalId:t,hour:e,minute:a}})}},{key:"handleCellLeave",value:function(){null!==this.state.hoveredCell&&this.setState({hoveredCell:null})}},{key:"handleCreateSlot",value:function(t,e,a){var n=this.state,o=n.timeslots,r=n.date,i=Math.floor(e),l=a,s="".concat(i.toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0")),d=60*i+l+20,u=Math.floor(d/60),c=d%60,p="".concat(u.toString().padStart(2,"0"),":").concat(c.toString().padStart(2,"0")),m={id:o.length>0?Math.max.apply(Math,h(o.map((function(t){return t.id}))))+1:1,professionalId:t,start:s,end:p,date:r,bookingProbability:.5,isBooked:!1,appointmentType:"In-person appointment",resource:"Default",rawData:null},g=[].concat(h(o),[m]);this.setState({timeslots:g}),this.updateRawData(g)}},{key:"handleAddSlot",value:function(t,e,a){var n=this.props.slotDuration,o=Math.floor(e),r=a,i="".concat(o.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0")),l=60*o+r+n,s=Math.floor(l/60),d=l%60,u="".concat(s.toString().padStart(2,"0"),":").concat(d.toString().padStart(2,"0"));this.setState({isAddingSlot:!0,selectedSlot:null,newSlot:{professionalId:t,start:i,end:u}})}},{key:"handleRemoveSlot",value:function(t){this.state.isDragging&&this.resetDragState();var e=this.state.timeslots.filter((function(e){return e.id!==t}));this.setState({timeslots:e,selectedSlot:null}),this.updateRawData(e)}},{key:"handleSaveSlot",value:function(){var t,e=this.state.timeslots,a=this.state,n=a.selectedSlot,o=a.newSlot;if(a.isAddingSlot){var r={id:e.length>0?Math.max.apply(Math,h(e.map((function(t){return t.id}))))+1:1,professionalId:o.professionalId,start:o.start,end:o.end,date:this.props.date,bookingProbability:.5,isBooked:!1,appointmentType:"In-person appointment",resource:"Default",rawData:null};t=[].concat(h(e),[r])}else t=e.map((function(t){return t.id===n.id?u(u({},t),n):t}));this.setState({timeslots:t,selectedSlot:null,isAddingSlot:!1,newSlot:{professionalId:null,start:null,end:null}}),this.updateRawData(t)}},{key:"handleCancelEdit",value:function(){this.setState({selectedSlot:null,isAddingSlot:!1,newSlot:{professionalId:null,start:null,end:null}})}},{key:"timeToDecimal",value:function(t){var e=s(t.split(":").map(Number),2);return e[0]+e[1]/60}},{key:"calculateSlotWidth",value:function(t,e,a){var n=this.timeToDecimal(t),o=60*(this.timeToDecimal(e)-n),r=Math.round(o/a);return Math.max(1,r)}},{key:"decimalToTime",value:function(t){var e=Math.max(0,t)%24,a=Math.floor(e),n=Math.round(60*(e-a)),o=n>=60?0:n;return"".concat(((n>=60?a+1:a)%24).toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0"))}},{key:"getProbabilityColor",value:function(t){if(t.isBooked)return"#808080";var e=t.bookingProbability;if(void 0===e)return"rgb(0, 147, 146)";var a=Math.max(0,Math.min(1,e)),n=["rgb(0, 147, 146)","rgb(57, 177, 133)","rgb(156, 203, 134)","rgb(233, 226, 156)","rgb(238, 180, 121)","rgb(232, 132, 113)","rgb(207, 89, 126)"];return n[Math.floor((1-a)*(n.length-1))]}},{key:"renderSlotRectangle",value:function(t){var e=this;if(!t)return null;var a=(this.props||{}).slotDuration;if(!a)return null;try{var n=this.getSlotWidth(t,a),r={position:"absolute",top:"2px",left:"0",height:"calc(100% - 4px)",width:"calc(".concat(100*n,"% + ").concat(n-1,"px)"),boxSizing:"border-box",backgroundColor:this.getProbabilityColor(t),color:"white",borderRadius:"0",display:"flex",justifyContent:"center",alignItems:"center",cursor:t.isBooked?"not-allowed":this.state.isDragging?"grabbing":"grab",boxShadow:"0 1px 2px rgba(0,0,0,0.1)",zIndex:100,transition:"all 0.15s ease-in-out",opacity:1},i={position:"absolute",top:0,bottom:0,width:"1px",cursor:"ew-resize",backgroundColor:"rgba(255, 255, 255, 0.5)",transition:"background-color 0.2s ease"},l=u(u({},i),{},{left:0,borderRadius:"0"}),s=u(u({},i),{},{right:0,borderRadius:"0"}),d={position:"absolute",top:0,bottom:0,width:"3px",cursor:"ew-resize",backgroundColor:"transparent",zIndex:101},c=u(u({},d),{},{left:"-1px"}),h=u(u({},d),{},{right:"-1px"});return o().createElement("div",{key:"slot-".concat(t.id),style:r,onClick:function(a){a.stopPropagation(),t.isBooked||e.handleSlotClick(t)},onMouseDown:function(a){t.isBooked||a.target!==a.currentTarget||0!==a.button||e.handleDragStart(a,t,"move")},onContextMenu:function(a){a.preventDefault(),a.stopPropagation(),t.isBooked||e.handleRemoveSlot(t.id)},title:"Time slot: ".concat(t.start," - ").concat(t.end,"\n").concat(t.isBooked?"Status: Booked":"Booking probability: ".concat(Math.round(100*(t.bookingProbability||.5)),"%"),"\nRight-click to remove\nDrag edges to resize\nDrag middle to move")},!t.isBooked&&o().createElement(o().Fragment,null,o().createElement("div",{style:l,onMouseEnter:function(t){t.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.8)"},onMouseLeave:function(t){t.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.5)"}}),o().createElement("div",{style:s,onMouseEnter:function(t){t.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.8)"},onMouseLeave:function(t){t.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.5)"}}),o().createElement("div",{style:c,onMouseDown:function(a){0===a.button&&e.handleDragStart(a,t,"start")},onMouseEnter:function(t){var e=t.currentTarget.previousSibling;e&&(e.style.backgroundColor="rgba(255, 255, 255, 0.8)")},onMouseLeave:function(t){var e=t.currentTarget.previousSibling;e&&(e.style.backgroundColor="rgba(255, 255, 255, 0.5)")}}),o().createElement("div",{style:h,onMouseDown:function(a){0===a.button&&e.handleDragStart(a,t,"end")},onMouseEnter:function(t){var e=t.currentTarget.previousSibling.previousSibling;e&&(e.style.backgroundColor="rgba(255, 255, 255, 0.8)")},onMouseLeave:function(t){var e=t.currentTarget.previousSibling.previousSibling;e&&(e.style.backgroundColor="rgba(255, 255, 255, 0.5)")}})))}catch(t){return console.error("Error rendering slot rectangle:",t),null}}},{key:"formatTime",value:function(t,e){return"".concat(Math.floor(t).toString().padStart(2,"0"),":").concat(e.toString().padStart(2,"0"))}},{key:"generateTimeCells",value:function(t,e){var a=this,n=this.props,r=n.startHour,i=n.endHour,l=n.slotDuration,d=this.state,c=d.timeslots,h=d.dragPreview,p=d.isDragging,m=d.dragType,g=d.creationStart,f=d.creationEnd,b=d.creationProfessionalId,v=60/l,S=[],y=c.filter((function(e){return e.professionalId===t.id})),D={};y.forEach((function(t){var e=s(t.start.split(":").map(Number),2),a=e[0],n=e[1],o="".concat(a,":").concat(n);D[o]=t}));var C=h&&h.professionalId===t.id,k=p&&C?h.id:null,w=p&&"create"===m&&b===t.id,E=null,x=null;if(w&&g&&f&&(E=this.timeToDecimal(g),(x=this.timeToDecimal(f))<E)){var T=[x,E];E=T[0],x=T[1]}for(var P=function(n){for(var r=function(){var r,s=i*l,d="".concat(n,":").concat(s),c="".concat(n.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0")),m=D[d],g=!p&&a.state.hoveredCell&&a.state.hoveredCell.professionalId===t.id&&a.state.hoveredCell.hour===n&&a.state.hoveredCell.minute===s,f=a.formatTime(n,s),b=u(u({},e.dashGanttTimeCell),{},{backgroundColor:g?"rgba(33, 150, 243, 0.4)":"transparent",position:"relative"}),v=n+s/60,y=C&&a.timeToDecimal(h.start)<=v&&a.timeToDecimal(h.end)>v,T=w&&E<=v&&x>v;r=p?y?o().createElement(o().Fragment,null,m&&m.id!==k&&a.renderSlotRectangle(m),o().createElement("div",{style:{position:"absolute",top:"2px",left:"0",right:"0",bottom:"2px",backgroundColor:"rgba(33, 150, 243, 0.4)",border:"1px ".concat("solid"," #1976D2"),pointerEvents:"none",zIndex:95}})):T?o().createElement(o().Fragment,null,m&&a.renderSlotRectangle(m),o().createElement("div",{style:{position:"absolute",top:"2px",left:"0",right:"0",bottom:"2px",backgroundColor:"rgba(76, 175, 80, 0.4)",border:"1px dashed #388E3C",pointerEvents:"none",zIndex:90}})):o().createElement(o().Fragment,null,(!p||(null==m?void 0:m.id)!==k)&&m&&a.renderSlotRectangle(m)):o().createElement(o().Fragment,null,m&&a.renderSlotRectangle(m),g&&!p&&o().createElement("div",{style:{position:"absolute",bottom:"2px",right:"2px",fontSize:"10px",color:"#666",pointerEvents:"none",backgroundColor:"rgba(255, 255, 255, 0.8)",padding:"1px 3px",borderRadius:"2px",zIndex:200,border:"1px solid #eaeaea"}},f)),S.push(o().createElement("td",{key:"cell-".concat(t.id,"-").concat(c),style:b,onClick:function(e){a.isCreatingSlot||a.justFinishedDragging||a.handleCreateSlot(t.id,n,s)},onMouseEnter:function(){p||a.handleCellHover(t.id,n,s)},onMouseLeave:function(){p||a.handleCellLeave()},onMouseDown:function(e){0!==e.button||m||(e.preventDefault(),a.handleCreationStart(e,t.id,n,s))},title:"Time: ".concat(f,"\nClick to add a 20-minute slot\nClick and drag to create a custom-length slot")},r))},i=0;i<v;i++)r()},R=r;R<=i;R++)P(R);return S}},{key:"getSlotWidth",value:function(t,e){if(!(t&&t.start&&t.end&&e))return 1;var a="".concat(t.id,"_").concat(t.start,"_").concat(t.end,"_").concat(e);if(void 0!==this.state.slotWidthCache[a])return this.state.slotWidthCache[a];var n=this.calculateSlotWidth(t.start,t.end,e);return this.state.slotWidthCache[a]=n,n}},{key:"shouldComponentUpdate",value:function(t,e){return!0}},{key:"componentDidUpdate",value:function(t){t.timeslots===this.props.timeslots&&t.slotDuration===this.props.slotDuration||this.setState({slotWidthCache:{}})}},{key:"updateRawData",value:function(t){var e=this,a=this.props,n=a.rawData,o=a.onDataChange,r=a.setProps,i=[];if(n&&n.length>0){var l=new Set;t.forEach((function(t){var a,n=null===(a=e.state.professionals.find((function(e){return e.id===t.professionalId})))||void 0===a?void 0:a.name;if(n){var o="".concat(t.date," ").concat(t.start,"_").concat(n);l.add(o)}})),i=n.filter((function(t){if(!t.datetime||!t.laakari)return!1;var e="".concat(t.datetime,"_").concat(t.laakari);return l.has(e)}))}t.forEach((function(t){var a;if(e.isValidTime(t.start)&&e.isValidTime(t.end)){var n=t.rawData,o=null===(a=e.state.professionals.find((function(e){return e.id===t.professionalId})))||void 0===a?void 0:a.name;if(o)if(n){var r,l=s(t.start.split(":").map(Number),2),d=l[0],c=l[1],h=s(t.end.split(":").map(Number),2),p=h[0],m=h[1];r=p<d||p===d&&m<c?60*(p+24)+m-(60*d+c):60*p+m-(60*d+c);var g=i.findIndex((function(e){return e.datetime==="".concat(t.date," ").concat(t.start)&&e.laakari===o}));-1!==g?i[g]=u(u({},i[g]),{},{datetime:"".concat(t.date," ").concat(t.start),kesto_min:r,tyhja:t.isBooked?0:1,bookingProbability:t.bookingProbability||.5}):i.push({datetime:"".concat(t.date," ").concat(t.start),laakari:o,kesto_min:r,tyhja:t.isBooked?0:1,bookingProbability:t.bookingProbability||.5})}else if(!n&&t.start&&t.end){var f,b=s(t.start.split(":").map(Number),2),v=b[0],S=b[1],y=s(t.end.split(":").map(Number),2),D=y[0],C=y[1];f=D<v||D===v&&C<S?60*(D+24)+C-(60*v+S):60*D+C-(60*v+S),i.push({datetime:"".concat(t.date," ").concat(t.start),laakari:o,kesto_min:f,tyhja:t.isBooked?0:1,bookingProbability:t.bookingProbability||.5,toimipiste:"Default",aikaryhman:"Default",aikaryhma:"Default",RESURSSI:"Default",specialty:"Default",ETNS_A:1,ETNS_B:1})}}else console.warn("Skipping invalid timeslot:",t)})),o&&o(i),r&&r({rawData:i})}},{key:"handleDragStart",value:function(t,e,a){if(t.stopPropagation(),!e.isBooked){var n=t.clientX,o=0;if("move"===a&&this.tableRef.current){var r=this.tableRef.current.getBoundingClientRect(),i=this.timeToDecimal(e.start)-this.props.startHour,l=this.props.endHour-this.props.startHour,s=r.width/l;o=n-(r.left+i*s)}this.setState({isDragging:!0,dragType:a,draggedSlot:e,originalSlot:u({},e),dragPreview:u({},e),initialMouseX:n,initialOffset:o}),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleDragEnd)}}},{key:"handleDrag",value:function(t){if(this.state.isDragging&&this.tableRef.current){var e=this.props,a=e.slotDuration,n=e.startHour,o=e.endHour,r=this.state,i=r.draggedSlot,l=r.dragType,s=r.initialOffset;if(i){var d,c=this.tableRef.current.getBoundingClientRect(),h=o-n,p=c.width/h;d="move"===l?t.clientX-c.left-s:t.clientX-c.left;var m=n+(d=Math.max(0,Math.min(d,c.width)))/p,g=Math.max(0,Math.floor(m)),f=Math.floor(60*(m-g)),b=Math.round(f/a)*a,v=b>=60?0:b,S=b>=60?g+1:g,y="".concat(Math.min(23,Math.max(0,S)).toString().padStart(2,"0"),":").concat(v.toString().padStart(2,"0")),D=u({},i);if("move"===l){var C=this.timeToDecimal(i.start),k=this.timeToDecimal(i.end)-C;D.start=y;var w=this.timeToDecimal(y)+k;D.end=this.decimalToTime(w)}else if("start"===l){var E=this.timeToDecimal(i.end),x=this.timeToDecimal(y);D.start=x<E?y:this.decimalToTime(E-a/60)}else if("end"===l){var T=this.timeToDecimal(i.start),P=this.timeToDecimal(y);D.end=P>T?y:this.decimalToTime(T+a/60)}this.isValidTime(D.start)&&this.isValidTime(D.end)&&this.setState({dragPreview:D})}}}},{key:"isValidTime",value:function(t){if(!t)return!1;if(!/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9])$/.test(t))return!1;var e=s(t.split(":").map(Number),2),a=e[0],n=e[1];return a>=0&&a<24&&n>=0&&n<60}},{key:"handleDragEnd",value:function(t){var e=this,a=this.state,n=a.isDragging,o=a.dragPreview,r=a.draggedSlot;if(a.originalSlot,a.dragType,n&&r){document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd);var i=r.id;if(this.justFinishedDragging=!0,setTimeout((function(){e.justFinishedDragging=!1}),100),o){var l=this.timeToDecimal(o.start);if(this.timeToDecimal(o.end)<=l)return void this.setState({isDragging:!1,dragType:null,draggedSlot:null,originalSlot:null,dragPreview:null});var s=this.state.timeslots,d=s.findIndex((function(t){return t.id===i}));if(-1!==d){var c=h(s);c[d]=u(u({},s[d]),{},{start:o.start,end:o.end}),this.setState({timeslots:c,isDragging:!1,dragType:null,draggedSlot:null,originalSlot:null,dragPreview:null}),this.updateRawData(c)}else console.warn("Could not find slot to update:",i),this.setState({isDragging:!1,dragType:null,draggedSlot:null,originalSlot:null,dragPreview:null})}else this.setState({isDragging:!1,dragType:null,draggedSlot:null,originalSlot:null,dragPreview:null})}}},{key:"handleCreationStart",value:function(t,e,a,n){if(0===t.button){t.preventDefault(),t.stopPropagation();var o=this.formatTime(a,n);this.setState({isDragging:!0,dragType:"create",creationProfessionalId:e,creationStart:o,creationEnd:o}),this.isCreatingSlot=!0,document.addEventListener("mousemove",this.handleCreationDrag),document.addEventListener("mouseup",this.handleCreationEnd)}}},{key:"handleCreationDrag",value:function(t){if(this.isCreatingSlot&&this.tableRef.current){var e=this.props,a=e.slotDuration,n=e.startHour,o=e.endHour,r=(this.state.creationStart,this.tableRef.current.getBoundingClientRect()),i=o-n,l=r.width/i,s=t.clientX-r.left,d=n+Math.max(0,Math.min(s,r.width))/l,u=Math.max(0,Math.floor(d)),c=Math.floor(60*(d-u)),h=Math.round(c/a)*a,p=h>=60?0:h,m=h>=60?u+1:u,g="".concat(Math.min(23,Math.max(0,m)).toString().padStart(2,"0"),":").concat(p.toString().padStart(2,"0"));this.setState({creationEnd:g})}}},{key:"handleCreationEnd",value:function(t){if(this.isCreatingSlot){document.removeEventListener("mousemove",this.handleCreationDrag),document.removeEventListener("mouseup",this.handleCreationEnd);var e=this.state,a=e.creationStart,n=e.creationEnd,o=e.creationProfessionalId,r=a,i=n,l=this.timeToDecimal(r);if(this.timeToDecimal(i)<l){var s=[i,r];r=s[0],i=s[1]}if(r!==i){var d=this.state,u=d.timeslots,c=d.date,p={id:u.length>0?Math.max.apply(Math,h(u.map((function(t){return t.id}))))+1:1,professionalId:o,start:r,end:i,date:c,bookingProbability:.5,isBooked:!1,appointmentType:"In-person appointment",resource:"Default",rawData:null},m=[].concat(h(u),[p]);this.setState({timeslots:m,isDragging:!1,dragType:null,creationStart:null,creationEnd:null,creationProfessionalId:null}),this.updateRawData(m)}else this.setState({isDragging:!1,dragType:null,creationStart:null,creationEnd:null,creationProfessionalId:null});this.isCreatingSlot=!1}}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.removeEventListener("mousemove",this.handleCreationDrag),document.removeEventListener("mouseup",this.handleCreationEnd)}},{key:"resetDragState",value:function(){document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.removeEventListener("mousemove",this.handleCreationDrag),document.removeEventListener("mouseup",this.handleCreationEnd),this.setState({isDragging:!1,dragType:null,draggedSlot:null,originalSlot:null,dragPreview:null,creationStart:null,creationEnd:null,creationProfessionalId:null}),this.isCreatingSlot=!1,this.justFinishedDragging=!1}},{key:"render",value:function(){for(var t=this,e=this.props,a=e.id,n=e.date,r=e.startHour,i=e.endHour,l=e.slotDuration,s=e.backgroundColor,d=this.state,c=d.professionals,h=(d.timeslots,60/l),p=(i-r)*h,m={dashGantt:{fontFamily:"Arial, sans-serif",margin:"20px 0"},dashGanttHeader:{marginBottom:"10px"},dashGanttContainer:{border:"1px solid #e0e0e0",borderRadius:"4px",overflow:"hidden",overflowX:"auto",boxShadow:"none"},dashGanttTable:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed",minWidth:"".concat(150+60*(i-r),"px")},dashGanttHeaderRow:{backgroundColor:s||"#ffffff"},dashGanttHeaderCell:{padding:"12px 8px",textAlign:"center",fontWeight:"500",borderRight:"1px solid #eaeaea",borderBottom:"1px solid #eaeaea",fontSize:"14px",color:"#444",position:"relative"},dashGanttFirstHeaderCell:{width:"150px",borderRight:"1px solid #eaeaea",borderBottom:"1px solid #eaeaea"},dashGanttRow:{height:"60px"},dashGanttProfessionalCell:{width:"150px",padding:"8px",borderRight:"1px solid #eaeaea",borderBottom:"1px solid #eaeaea",backgroundColor:s||"#ffffff",verticalAlign:"middle",fontWeight:"500",fontSize:"14px",color:"#444"},dashGanttTimeCell:{position:"relative",padding:"0",borderRight:"1px solid #f5f5f5",borderBottom:"1px solid #eaeaea",cursor:"pointer",height:"60px",minWidth:"5px",width:"".concat(100/p,"%"),boxSizing:"border-box",transition:"background-color 0.2s ease"},dashGanttSlot:{position:"absolute",top:"0",height:"100%",backgroundColor:"#4CAF50",color:"white",borderRadius:"4px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",zIndex:10,overflow:"hidden"},dashGanttProbability:{fontSize:"14px",fontWeight:"500"},dashGanttEditor:{marginTop:"20px",padding:"15px",border:"1px solid #eaeaea",borderRadius:"4px",backgroundColor:"#ffffff"},dashGanttForm:{display:"flex",flexDirection:"column",gap:"10px"},dashGanttFormGroup:{display:"flex",alignItems:"center"},dashGanttFormGroupLabel:{width:"100px",marginRight:"10px",color:"#444",fontSize:"14px"},dashGanttFormGroupInput:{flex:1,padding:"8px",border:"1px solid #eaeaea",borderRadius:"4px",fontSize:"14px"},dashGanttFormActions:{display:"flex",gap:"10px",marginTop:"10px"},dashGanttFormActionsButton:{padding:"8px 15px",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"500",fontSize:"14px"},dashGanttFormActionsSave:{backgroundColor:"#2196F3",color:"white"},dashGanttFormActionsCancel:{backgroundColor:"#f5f5f5",color:"#333"},dashGanttFormActionsRemove:{backgroundColor:"#f44336",color:"white"}},g=[],f=r;f<=i;f++){var b=f%24,v=b>=12,S="".concat(0===b?12:b>12?b-12:b).concat(v?"PM":"AM");g.push(S)}return o().createElement("div",{id:a,style:m.dashGantt},o().createElement("div",{style:m.dashGanttHeader},o().createElement("h2",null,"Schedule for ",n)),o().createElement("div",{style:m.dashGanttContainer},o().createElement("table",{ref:this.tableRef,style:m.dashGanttTable},o().createElement("thead",null,o().createElement("tr",{style:m.dashGanttHeaderRow},o().createElement("th",{style:m.dashGanttFirstHeaderCell}),function(){for(var t=[],e=r;e<=i;e++){var a="".concat((24===e?24:e%24).toString().padStart(2,"0"),":00");t.push(o().createElement("th",{key:"header-".concat(e),colSpan:h,style:m.dashGanttHeaderCell},a))}return t}())),o().createElement("tbody",null,c.map((function(e){return o().createElement("tr",{key:"row-".concat(e.id),style:m.dashGanttRow},o().createElement("td",{style:m.dashGanttProfessionalCell},e.name),t.generateTimeCells(e,m))}))))),this.state.selectedSlot||this.state.isAddingSlot?o().createElement("div",{style:m.dashGanttEditor},o().createElement("h3",null,this.state.isAddingSlot?"Add New Slot":"Edit Slot"),o().createElement("div",{style:m.dashGanttForm},o().createElement("div",{style:m.dashGanttFormGroup},o().createElement("label",{style:m.dashGanttFormGroupLabel},"Professional:"),o().createElement("select",{style:m.dashGanttFormGroupInput,value:this.state.isAddingSlot?this.state.newSlot.professionalId:this.state.selectedSlot.professionalId,onChange:function(e){var a=parseInt(e.target.value);t.state.isAddingSlot?t.setState({newSlot:u(u({},t.state.newSlot),{},{professionalId:a})}):t.setState({selectedSlot:u(u({},t.state.selectedSlot),{},{professionalId:a})})},disabled:!this.state.isAddingSlot},c.map((function(t){return o().createElement("option",{key:t.id,value:t.id},t.name)})))),o().createElement("div",{style:m.dashGanttFormGroup},o().createElement("label",{style:m.dashGanttFormGroupLabel},"Start Time:"),o().createElement("input",{type:"time",style:m.dashGanttFormGroupInput,value:this.state.isAddingSlot?this.state.newSlot.start:this.state.selectedSlot.start,onChange:function(e){var a=e.target.value;t.state.isAddingSlot?t.setState({newSlot:u(u({},t.state.newSlot),{},{start:a})}):t.setState({selectedSlot:u(u({},t.state.selectedSlot),{},{start:a})})}})),o().createElement("div",{style:m.dashGanttFormGroup},o().createElement("label",{style:m.dashGanttFormGroupLabel},"End Time:"),o().createElement("input",{type:"time",style:m.dashGanttFormGroupInput,value:this.state.isAddingSlot?this.state.newSlot.end:this.state.selectedSlot.end,onChange:function(e){var a=e.target.value;t.state.isAddingSlot?t.setState({newSlot:u(u({},t.state.newSlot),{},{end:a})}):t.setState({selectedSlot:u(u({},t.state.selectedSlot),{},{end:a})})}})),o().createElement("div",{style:m.dashGanttFormActions},o().createElement("button",{style:u(u({},m.dashGanttFormActionsButton),m.dashGanttFormActionsSave),onClick:this.handleSaveSlot},"Save"),o().createElement("button",{style:u(u({},m.dashGanttFormActionsButton),m.dashGanttFormActionsCancel),onClick:this.handleCancelEdit},"Cancel"),!this.state.isAddingSlot&&o().createElement("button",{style:u(u({},m.dashGanttFormActionsButton),m.dashGanttFormActionsRemove),onClick:function(){return t.handleRemoveSlot(t.state.selectedSlot.id)}},"Remove")))):null)}}],r=[{key:"transformData",value:function(t,e){if(!t||!e)return{professionals:[],timeslots:[]};var a=t.filter((function(t){return t.datetime.split(" ")[0]===e})),n=Array.from(new Set(a.map((function(t){return t.laakari})))).map((function(t,e){return{id:e+1,name:t}})),o=Object.fromEntries(n.map((function(t,e){return[t.name,e+1]}))),r=a.map((function(t,e){var a=s(t.datetime.split(" "),2),n=a[0],r=a[1],i=r,l=s(r.split(":").map(Number),2),d=l[0],u=l[1],c=new Date;c.setHours(d,u,0);var h=t.kesto_min||0,p=new Date(c.getTime()+6e4*h),m="".concat(p.getHours().toString().padStart(2,"0"),":").concat(p.getMinutes().toString().padStart(2,"0"));return{id:e+1,professionalId:o[t.laakari],start:i,end:m,date:n,durationMinutes:h,bookingProbability:t.bookingProbability||.5,isBooked:0===t.tyhja,rawData:t}}));return{professionals:n,timeslots:r}}},{key:"getDerivedStateFromProps",value:function(t,a){if(!t)return null;var n=t.rawData,o=t.date;if(n!==a.rawData||o!==a.date){var r=e.transformData(n||[],o||a.date);return{professionals:r.professionals||[],timeslots:r.timeslots||[],rawData:n||[],date:o||a.date}}return null}}],n&&g(a.prototype,n),r&&g(a,r),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,n,r}(n.Component);y.defaultProps={rawData:[],date:(new Date).toISOString().split("T")[0],startHour:6,endHour:23,slotDuration:5,backgroundColor:"#f5f5f5",onDataChange:null},y.propTypes={id:i().string,rawData:i().arrayOf(i().shape({datetime:i().string.isRequired,laakari:i().string.isRequired,kesto_min:i().number.isRequired,tyhja:i().number.isRequired})),date:i().string,startHour:i().number,endHour:i().number,slotDuration:i().number,backgroundColor:i().string,onDataChange:i().func,setProps:i().func}}}]);
//# sourceMappingURL=async-DashGantt.js.map